{% extends "base.html" %}

{% block title %}Pre-Stage Results - AI Home Staging{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header text-center">
                <h3><i class="fas fa-clipboard-list me-2"></i>Pre-Stage Requirements</h3>
                <p class="text-muted mb-0">
                    For {{ room_counts.bedrooms }} bedroom(s), {{ room_counts.living_rooms }} living room(s), 
                    {{ room_counts.dining_rooms }} dining room(s), and {{ room_counts.home_office }} home office(ies)
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h4 class="text-primary">{{ requirements|length }}</h4>
                <p class="text-muted mb-0">Total Items Needed</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h4 class="text-success">{{ shortages|length }}</h4>
                <p class="text-muted mb-0">Items to Acquire</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h4 class="text-info">{{ requirements.values()|sum }}</h4>
                <p class="text-muted mb-0">Total Quantity</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h4 class="text-warning">{{ shortages.values()|sum }}</h4>
                <p class="text-muted mb-0">Shortage Quantity</p>
            </div>
        </div>
    </div>
</div>

<!-- Requirements Breakdown -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list me-2"></i>Detailed Requirements</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Item</th>
                                <th>Required</th>
                                <th>In Stock</th>
                                <th>Shortage</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item, needed in requirements.items() %}
                            {% set current = inventory.get(item, 0) %}
                            {% set shortage = needed - current if needed > current else 0 %}
                            <tr>
                                <td>
                                    <strong>{{ item.replace('_', ' ').title() }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-primary">{{ needed }}</span>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if current > 0 else 'secondary' }}">{{ current }}</span>
                                </td>
                                <td>
                                    {% if shortage > 0 %}
                                        <span class="badge bg-danger">{{ shortage }}</span>
                                    {% else %}
                                        <span class="badge bg-success">0</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if shortage == 0 %}
                                        <span class="badge bg-success">‚úÖ Ready</span>
                                    {% elif shortage < needed %}
                                        <span class="badge bg-warning">‚ö†Ô∏è Partial</span>
                                    {% else %}
                                        <span class="badge bg-danger">‚ùå Missing</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Action Items -->
{% if shortages %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-exclamation-triangle me-2"></i>Action Items</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for item, shortage in shortages.items() %}
                    <div class="col-md-6 mb-3">
                        <div class="d-flex justify-content-between align-items-center p-3 border rounded">
                            <div>
                                <h6 class="mb-1">{{ item.replace('_', ' ').title() }}</h6>
                                <small class="text-muted">Need {{ shortage }} more</small>
                            </div>
                            <span class="badge bg-danger">{{ shortage }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="text-center mt-3">
                    <a href="{{ url_for('inventory') }}" class="btn btn-primary me-2">
                        <i class="fas fa-warehouse me-2"></i>Update Inventory
                    </a>
                    <a href="{{ url_for('prestage') }}" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-calculator me-2"></i>Recalculate
                    </a>
                    <form method="POST" action="{{ url_for('create_houses_from_prestage') }}" class="d-inline">
                        <input type="hidden" name="king_bedrooms" value="{{ room_counts.king_bedrooms }}">
                        <input type="hidden" name="queen_bedrooms" value="{{ room_counts.queen_bedrooms }}">
                        <input type="hidden" name="full_bedrooms" value="{{ room_counts.full_bedrooms }}">
                        <input type="hidden" name="twin_bedrooms" value="{{ room_counts.twin_bedrooms }}">
                        <input type="hidden" name="living_rooms" value="{{ room_counts.living_rooms }}">
                        <input type="hidden" name="dining_rooms" value="{{ room_counts.dining_rooms }}">
                        <input type="hidden" name="offices" value="{{ room_counts.offices }}">
                        <input type="hidden" name="outdoor_rooms" value="{{ room_counts.outdoor_rooms }}">
                        <input type="hidden" name="dining_chair_count" value="{{ room_counts.dining_chair_count }}">
                        <input type="hidden" name="dining_table_shape" value="{{ room_counts.dining_table_shape }}">
                        <input type="hidden" name="dining_table_type" value="{{ room_counts.dining_table_type }}">
                        <input type="hidden" name="dining_table_size" value="{{ room_counts.dining_table_size }}">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-home me-2"></i>Create Houses
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h5 class="text-success">üéâ You're All Set!</h5>
                <p class="text-muted">Your current inventory covers all requirements for this staging project.</p>
                <a href="{{ url_for('upload') }}" class="btn btn-primary">
                    <i class="fas fa-upload me-2"></i>Start Staging
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Room Breakdown -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-home me-2"></i>Room Breakdown</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% if room_counts.bedrooms > 0 %}
                    <div class="col-md-6 mb-3">
                        <h6><i class="fas fa-bed me-2"></i>Bedrooms ({{ room_counts.bedrooms }})</h6>
                        <ul class="list-unstyled">
                            <li>‚Ä¢ {{ room_counts.bedrooms }} Bed(s)/Bedframe(s)</li>
                            <li>‚Ä¢ {{ room_counts.bedrooms }} Headboard(s)</li>
                            <li>‚Ä¢ {{ room_counts.bedrooms * 2 }} Nightstand(s)</li>
                            <li>‚Ä¢ {{ room_counts.bedrooms }} Dresser(s)</li>
                            <li>‚Ä¢ {{ room_counts.bedrooms * 2 }} Bedside Lamp(s)</li>
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if room_counts.living_rooms > 0 %}
                    <div class="col-md-6 mb-3">
                        <h6><i class="fas fa-couch me-2"></i>Living Rooms ({{ room_counts.living_rooms }})</h6>
                        <ul class="list-unstyled">
                            <li>‚Ä¢ {{ room_counts.living_rooms }} Couch(es)</li>
                            <li>‚Ä¢ {{ room_counts.living_rooms }} Coffee Table(s)</li>
                            <li>‚Ä¢ {{ room_counts.living_rooms * 2 }} End Table(s)</li>
                            <li>‚Ä¢ {{ room_counts.living_rooms }} Floor Lamp(s)</li>
                            <li>‚Ä¢ {{ room_counts.living_rooms * 2 }} Accent Chair(s)</li>
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if room_counts.dining_rooms > 0 %}
                    <div class="col-md-6 mb-3">
                        <h6><i class="fas fa-utensils me-2"></i>Dining Rooms ({{ room_counts.dining_rooms }})</h6>
                        <ul class="list-unstyled">
                            <li>‚Ä¢ {{ room_counts.dining_rooms }} Dining Table(s)</li>
                            <li>‚Ä¢ {{ room_counts.dining_rooms * 4 }} Dining Chair(s)</li>
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if room_counts.home_office > 0 %}
                    <div class="col-md-6 mb-3">
                        <h6><i class="fas fa-briefcase me-2"></i>Home Offices ({{ room_counts.home_office }})</h6>
                        <ul class="list-unstyled">
                            <li>‚Ä¢ {{ room_counts.home_office }} Desk(s)</li>
                            <li>‚Ä¢ {{ room_counts.home_office }} Desk Chair(s)</li>
                            <li>‚Ä¢ {{ room_counts.home_office }} Bookshelf(es)</li>
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Navigation -->
<div class="row mt-4">
    <div class="col-12 text-center">
        <a href="{{ url_for('prestage') }}" class="btn btn-outline-primary me-2">
            <i class="fas fa-calculator me-2"></i>New Calculation
        </a>
        <a href="{{ url_for('inventory') }}" class="btn btn-outline-secondary me-2">
            <i class="fas fa-warehouse me-2"></i>Manage Inventory
        </a>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-info">
            <i class="fas fa-home me-2"></i>Dashboard
        </a>
    </div>
</div>
{% endblock %} 